(()=>{"use strict";function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t{constructor(t,i,s){e(this,"_text",""),e(this,"_callback",null),e(this,"_itemClass",""),this._text=t,this._callback=i,this._itemClass=s}onBtnClick(){const e=this._callback;"function"==typeof e&&e()}getTemplate(){const e=document.createElement("button");return e.classList.add(this._itemClass),e}render(e){if(e){const t=this.getTemplate(this._itemClass);t.innerHTML=this._text,e.appendChild(t),t.addEventListener("click",(()=>{this.onBtnClick()}))}}}function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class s{constructor({name:e,price:t,img:s,value:n},r){i(this,"_name",""),i(this,"_price",0),i(this,"_img",0),i(this,"_value",1),i(this,"_BasketInstance",null),this._name=e,this._price=t,this._img=s,this._value=n,this._BasketInstance=r}addToCart(){this._BasketInstance.add(this)}render(){const e=document.querySelector(".goods-list");if(e){const i=document.createElement("div");i.innerHTML=`\n         <img src="${this._img}"> \n         <p class="cart-item__name">${this._name}</p> \n         <p class="cart-item__price">$${this._price}</p>\n         `,i.classList.add("border-line"),i.classList.add("cart-item"),new t("Добавить в корзину",this.addToCart.bind(this),"cart-item__btn").render(i),e.appendChild(i)}}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{constructor({name:e,price:t,img:i}){n(this,"_name",""),n(this,"_price",0),n(this,"_img",0),n(this,"_counter",1),this._name=e,this._price=t,this._img=i}oneMoreProduct(){this._counter++,BasketInstance.render()}deleteOneProduct(){this._counter--,BasketInstance.render()}deleteAllGoods(){BasketInstance.removeItems(this)}render(e){const i=document.createElement("div");i.innerHTML=`\n         <img src="${this._img}"> \n         <p class="cart-item__name">${this._name}</p> \n         <p class="cart-item__price">$${this._price}</p>\n         <div class="cart-item__price-block price-block">\n         <input class="price-block__input-value" type="number" value="${this._counter}" min="0" max="99"/>\n         </div>\n         `,i.classList.add("border-line"),i.classList.add("cart-item"),new t("+",this.oneMoreProduct.bind(this),"price-block__btn-add").render(i),new t("-",this.deleteOneProduct.bind(this),"price-block__btn-remove").render(i),new t("Удалить все",this.deleteAllGoods.bind(this),"price-block__btn-remove-all").render(i),e.appendChild(i)}}let c=0;const a=new class{constructor(){var e,t;t=[],(e="_items")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}add(e){const t=this._items.find((t=>t._name===e._name));t?t._counter++:this._items.push(new r({name:e._name,price:e._price,img:e._img})),this.render()}removeItems(e){const t=this._items.find((t=>t._name===e._name));if(t){const e=this._items.indexOf(t);this._items.splice(e,1)}this.render()}render(){const e=document.querySelector(".basket-list");let t=0;this._items.forEach((e=>(t+=e._price*e._counter,t))),e&&(e.innerHTML="",e.innerHTML=`<h2 class="header-h2">Корзина</h2> <div class="sum">Общая сумма: $${t}</div>`),this._items.forEach((e=>{if(0===e._counter){const t=this._items.indexOf(e);this._items.splice(t,1)}})),this._items.forEach((t=>{t.render(e)}))}};new class{constructor(e){var t,i;i=[],(t="_items")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.fetchGoods().then((e=>e.json())).then((t=>{const i=t.data.map((t=>new s(t,e)));this._items=i,this.render(),this.renderShowMore()}))}fetchGoods(){return fetch("/database/items.json")}showMore(){c<3?(fetch(["/database/items1.json","/database/items2.json","/database/items3.json"][c]).then((e=>e.json())).then((e=>{const t=e.data.map((e=>new s(e,a)));this._items=t,this.render(),this.addMore()})),c++):this.deleteButton(),this.deleteButton()}deleteButton(){const e=document.querySelectorAll(".cart-item__btn");e[e.length-1].remove()}addMore(){c<3&&this.renderShowMore()}renderShowMore(){const e=document.querySelector(".goods-list");new t("Показать ещё",this.showMore.bind(this),"cart-item__btn").render(e)}render(){this._items.forEach((e=>{e.render()}))}}(a)})();